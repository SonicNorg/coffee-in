{% extends "flask_user/_authorized_base.html" %}

{% block content %}
<h1>Hi, {{ user.username }}!</h1>
{% if not current_buyin %}
    <h3>Текущая закупка отсутствует</h3>
{% else %}
    {% include 'fragments/current_buyin.html' %}
{% endif %}
<h4>Мой заказ в офис: {{ my_office_order }}</h4>
<br>
<h4>Мой заказ домой:
    {% if my_own_order and my_own_order.rows %}
    {{ my_own_order.total50 }} - {{ my_own_order.total25 }} руб.
    {% endif %}
</h4>
<table class="table table-striped table-hover">
    <thead>
    <tr>
        <th>Сорт</th>
        <th>Описание</th>
        <th>Кол-во</th>
        <th>От 25 кг</th>
        <th>От 50 кг</th>
    </tr>
    </thead>
    <tbody>
    {% if not my_own_order or not my_own_order.rows %}
    <tr>
        <td colspan="5">В заказе пусто. <a href="{{ url_for('price') }}">Выбрать кофе</a></td>
    </tr>
    {% else %}
    {% for order_row in my_own_order.rows %}
    <form action="{{ url_for('delete_order_row') }}" method="post">
        {{ delete_row_form.hidden_tag() }}
        {{ delete_row_form.id(hidden='hidden', value=order_row[0].id) }}
        <tr>
            <td>{{ order_row[0].coffee_type.name }}</td>
            <td>{{ order_row[0].coffee_type.description }}</td>
            <td>{{ order_row[0].amount }} кг</td>
            <td>{{ order_row[1].price25 * order_row[0].amount }} руб.</td>
            <td>{{ order_row[1].price50 * order_row[0].amount }} руб.</td>
            <td>{{ delete_row_form.submit() }}</td>
        </tr>
    </form>
    {% endfor %}
    {% endif %}
    </tbody>
</table>
{% endblock %}